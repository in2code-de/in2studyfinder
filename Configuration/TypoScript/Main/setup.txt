config.pageTitleProviders {
	in2studyfinder {
		provider = In2code\In2studyfinder\PageTitle\CoursePageTitleProvider
		before = record
	}
}

plugin.tx_in2studyfinder {
	view {
		templateRootPaths.0 = {$plugin.tx_in2studyfinder.view.templateRootPath}
		partialRootPaths.0 = {$plugin.tx_in2studyfinder.view.partialRootPath}
		layoutRootPaths.0 = {$plugin.tx_in2studyfinder.view.layoutRootPath}
	}

	settings {
		storagePid = {$plugin.tx_in2studyfinder.settings.storagePid}
		settingsPid = {$plugin.tx_in2studyfinder.settings.settingsPid}

		pagination {
			itemsPerPage = {$plugin.tx_in2studyfinder.settings.pagination.itemsPerPage}
		}

		filters {
			graduation {
				type = object
				singleSelect = 0
				objectModel = In2code\In2studyfinder\Domain\Model\Graduation
				propertyPath = academicDegree.graduation
				frontendLabel = LLL:EXT:in2studyfinder/Resources/Private/Language/locallang.xlf:graduation
			}

			typeOfStudy {
				type = object
				singleSelect = 0
				objectModel = In2code\In2studyfinder\Domain\Model\TypeOfStudy
				propertyPath = typesOfStudy
				frontendLabel = LLL:EXT:in2studyfinder/Resources/Private/Language/locallang.xlf:typeOfStudy
			}

			admissionRequirement {
				type = object
				singleSelect = 0
				objectModel = In2code\In2studyfinder\Domain\Model\AdmissionRequirement
				propertyPath = admissionRequirements
				frontendLabel = LLL:EXT:in2studyfinder/Resources/Private/Language/locallang.xlf:admissionRequirement
			}

			startOfStudy {
				type = object
				singleSelect = 0
				objectModel = In2code\In2studyfinder\Domain\Model\StartOfStudy
				propertyPath = startsOfStudy
				frontendLabel = LLL:EXT:in2studyfinder/Resources/Private/Language/locallang.xlf:startOfStudy
			}

			courseLanguage {
				type = object
				singleSelect = 1
				objectModel = In2code\In2studyfinder\Domain\Model\CourseLanguage
				propertyPath = courseLanguages
				frontendLabel = LLL:EXT:in2studyfinder/Resources/Private/Language/locallang.xlf:courseLanguage
			}

			faculty {
				type = object
				singleSelect = 0
				objectModel = In2code\In2studyfinder\Domain\Model\Faculty
				propertyPath = faculty
				frontendLabel = LLL:EXT:in2studyfinder/Resources/Private/Language/locallang.xlf:faculty
			}

			department {
				type = object
				singleSelect = 0
				objectModel = In2code\In2studyfinder\Domain\Model\Department
				propertyPath = department
				frontendLabel = LLL:EXT:in2studyfinder/Resources/Private/Language/locallang.xlf:department
				#                disabledInFrontend = 1
			}

			#            credits {
			#                type = boolean
			#                propertyPath = ectsCredits
			#                frontendLabel = FrontendLabel
			#            }
		}

		backend {
			pluginPreviewTemplate = {$plugin.tx_in2studyfinder.settings.backend.pluginPreviewTemplate}

			export {
				excludedPropertiesForExport {
					0 = _localizedUid
					1 = _languageUid
					2 = _versionedUid
					3 = globalDataPreset
					4 = globalData
					5 = contentElements
					6 = pid
					7 = uid
					8 = deleted
					9 = hidden
					10 = sorting
					11 = parent
				}

				includeDeleted = 0
				includeHidden = 0
			}
		}

	}

	persistence {
		storagePid = {$plugin.tx_in2studyfinder.persistence.storagePid}
		recursive = {$plugin.tx_in2studyfinder.persistence.recursive}
	}
}

plugin.tx_in2studyfinder_chatbot {
    settings {
        prompt {
            default = TEXT
            default.value (
                You are an academic advising assistant for a college/university.
                Your main task is to help prospective students find suitable degree programs.

                YOUR TASKS:
                1. Understand the interests, skills, and qualifications of prospective students
                2. Use the available tools to specifically search for suitable degree programs
                3. Clearly explain program content, requirements, and career prospects
                4. Show URLs to the appropriate degree programs. Do not invent URLs – use tools.

                CONVERSATION GUIDELINES:
                - Ask targeted questions to understand the needs:
                  * What subjects/topics interest you?
                  * What degree are you aiming for?
                  * Do you have specific career goals?
                  * What prior experience/qualifications do you have?
                - Use the answers to call relevant tools
                - Explain search results in clear, understandable language

                RESPONSE FORMAT:
                - Respond in a friendly and encouraging manner
                - Structure your answers clearly (use paragraphs)
                - Explain WHY a degree program is a good fit
                - ALWAYS provide a URL to the degree program.

                EXAMPLE RESPONSES:
                For the question 'What computer science degree programs are there?':
                1. Use search_study_programs with 'Computer Science'
                2. Present the results in a structured manner
                3. Explain the differences between the programs
                4. Ask about specific interests for further narrowing

                IMPORTANT NOTES:
                - ALWAYS use the available tools for specific searches
                - Do not invent degree programs or information – use tools
                - For unclear requests: ask follow-up questions
                - Do not suggest courses that are not in the database

                COMMON SCENARIOS:
                - Undecided: Ask about interests and strengths
                - Known field of study: Show all variations
                - Career changers: Explain bridging courses and requirements
                - Master's applicants: Check Bachelor’s compatibility

                Respond in English and be a helpful, competent academic advisor!";
            )

            de = TEXT
            de.value (
                Du bist ein Studienberatungs-Assistent für eine Hochschule/Universität.
                Deine Hauptaufgabe ist es, Studieninteressierten dabei zu helfen, passende Studiengänge zu finden.

                DEINE AUFGABEN:
                1. Verstehe die Interessen, Fähigkeiten und Voraussetzungen der Studieninteressierten
                2. Nutze die verfügbaren Tools um gezielt nach passenden Studiengängen zu suchen
                3. Erkläre Studienganginhalte, Voraussetzungen und Karriereperspektiven verständlich
                4. Zeige Urls zu den passenden Studiengängen. Erfinde keine Urls, sondern verwende Tools.

                GESPRÄCHSFÜHRUNG:
                - Stelle gezielte Fragen um die Bedürfnisse zu verstehen:
                  * Welche Fächer/Themen interessieren dich?
                  * Welchen Abschluss strebst du an?
                  * Hast du bestimmte Karriereziele?
                  * Welche Vorerfahrungen/Qualifikationen hast du?
                - Nutze die Antworten um relevante Tools aufzurufen
                - Erkläre Suchergebnisse in verständlicher Sprache

                ANTWORTFORMAT:
                - Antworte freundlich und motivierend
                - Strukturiere deine Antworten klar. (Nutze Absätze)
                - Erkläre WARUM ein Studiengang gut passt
                - Gib IMMER eine Url zum Studiengang an.

                BEISPIEL-ANTWORTEN:
                Bei der Frage 'Welche Informatik-Studiengänge gibt es?':
                1. Nutze search_study_programs mit 'Informatik'
                2. Präsentiere die Ergebnisse strukturiert
                3. Erkläre Unterschiede zwischen den Studiengängen
                4. Frage nach spezifischen Interessen für weitere Eingrenzung

                WICHTIGE HINWEISE:
                - Nutze IMMER die verfügbaren Tools für konkrete Suchen
                - Erfinde keine Studiengänge oder Informationen, verwende Tools
                - Bei unklaren Anfragen: Stelle Rückfragen
                - Schlage keine Studiengänge die nicht in der Datenbank sind vor

                HÄUFIGE SZENARIEN:
                - Unentschlossene: Frage nach Interessen und Stärken
                - Fachrichtung bekannt: Zeige alle Varianten auf
                - Quereinsteiger: Erkläre Brückenkurse und Voraussetzungen
                - Master-Suchende: Prüfe Bachelor-Kompatibilität

                Antworte auf Deutsch und sei ein hilfreicher, kompetenter Studienberater!";
            )
        }
    }
}

# Module configuration
module.tx_in2studyfinder < plugin.tx_in2studyfinder

# Rendering of content elements in detail view
lib.tx_in2studyfinder.contentElementRendering = RECORDS
lib.tx_in2studyfinder.contentElementRendering {
	tables = tt_content
	source.current = 1
	dontCheckPid = 1
}

############################
# Page type for ajax request
############################
in2studyfinderFilterAjax = PAGE
in2studyfinderFilterAjax {
	typeNum = 1308171055
	config {
		additionalHeaders = Content-type:application/html
		disableAllHeaderCode = 1
		disablePrefixComment = 1
		admPanel = 0
		debug = 0
	}

	10 = USER_INT
	10 {
		userFunc = TYPO3\CMS\Extbase\Core\Bootstrap->run
		extensionName = In2studyfinder
		pluginName = Pi1
		vendorName = In2code
		controller = StudyCourse
		// the action is ignored at this point.
		// It is possible to set an different action via an query argument
		// see: https://forge.typo3.org/issues/88399#note-5
		action = filter
		features.requireCHashArgumentForActionArguments = 0
	}
}

studyFinderAiChatbot = PAGE
studyFinderAiChatbot {
    typeNum = 1749648666

    config {
        additionalHeaders.10.header = Content-Type: application/json
        additionalHeaders.10.replace = 1
        no_cache = 1
        disableAllHeaderCode = 1
        disablePrefixComment = 1
        xhtml_cleaning = 0
        admPanel = 0
        debug = 0
    }

    10 = USER
    10 {
        userFunc = TYPO3\CMS\Extbase\Core\Bootstrap->run
        extensionName = In2studyfinder
        pluginName = Chatbot
        vendorName = In2code
        controller = Chat
        action = chat
        switchableControllerActions.Chat.1 = chat
    }
}

############################
# JavaScript and CSS section
############################

page.includeCSS.in2studyfinderCss = {$plugin.tx_in2studyfinder.settings.css.in2studyfinderCss}

page.includeJSFooterlibs.in2studyfinder = {$plugin.tx_in2studyfinder.settings.javascript.main}
