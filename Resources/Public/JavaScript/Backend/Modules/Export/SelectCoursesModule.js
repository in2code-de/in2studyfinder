import AjaxUtility from"./../../Utility/AjaxUtility.js";import UrlUtility from"./../../Utility/UrlUtility.js";class SelectCoursesModule{coursesList=[];identifiers={checkAllCheckbox:".js-in2studyfinder-check-all",paginationContainer:".js-in2studyfinder-pagebrowser",itemsPerPageSelect:".js-in2studyfinder-itemsPerPage",changeLanguageSelect:".js-in2studyfinder-recordLanguage",courseListTableBody:".js-in2studyfinder-course-list",loader:".in2js-in2studyfinder-loader",loaderActive:".in2studyfinder-loader--active",selectCourseContainer:".js-in2studyfinder-select-course-container",selectedCoursesCount:".js-in2studyfinder-selected-courses-count",paginationTarget:".js-in2studyfinder-pagination",courseCheckbox:".js-in2studyfinder-select-course"};elements={};initialize(){this.#e(),this.#t(),this.#s(),this.#i(),this.#n()}#e(){for(const e in this.identifiers)this.elements[e]=document.querySelector(this.identifiers[e])}#i(){this.elements.checkAllCheckbox?.addEventListener("click",e=>this.#r(e)),this.elements.paginationContainer?.addEventListener("click",e=>this.#a(e)),this.elements.itemsPerPageSelect?.addEventListener("change",e=>this.#o(e)),this.elements.changeLanguageSelect?.addEventListener("change",e=>this.#l(e)),this.elements.courseListTableBody?.addEventListener("click",e=>this.#c(e))}#a(e){e.preventDefault();const t=e.target.href;if(!t)return;const s=this.elements.itemsPerPageSelect.value,i=UrlUtility.addAttributeToUrl(t,"itemsPerPage",s);this.#d(i)}#d(e){AjaxUtility.ajaxCall(e,()=>this.#u(),e=>this.#h(e))}#u(){this.elements.loader?.classList.add(this.identifiers.loaderActive.substring(1))}async#h(e){const t=await e.text(),s=(new DOMParser).parseFromString(t,"text/html").querySelector(this.identifiers.selectCourseContainer);s&&(this.elements.selectCourseContainer.innerHTML=s.innerHTML),this.initialize(),this.elements.loader?.classList.remove(this.identifiers.loaderActive.substring(1))}#o(e){const t=e.target.selectedOptions[0]?.dataset.action;t&&this.#d(t)}#l(e){const t=e.target.selectedOptions[0]?.dataset.action;console.log(t),t&&this.#g()&&this.#d(t)}#c(e){const t=e.target;t.matches(this.identifiers.courseCheckbox)&&(t.checked?this.#C(t.value):this.#m(t.value),this.#n())}#r(e){const t=e.target.checked,s=document.querySelectorAll(this.identifiers.courseCheckbox);for(const e of s){e.checked=t;const s=e.dataset.in2studyfinderCourseUid;s&&(t?this.#C(s):this.#m(s))}this.#n()}#s(){if(0!==this.coursesList.length)for(const e of this.coursesList){const t=document.querySelector(`#course-${e}`);t&&(t.checked=!0)}}#C(e){this.coursesList.includes(e)||this.coursesList.push(e)}#m(e){this.coursesList=this.coursesList.filter(t=>t!==e)}#g(){if(this.coursesList.length>0){if(!confirm("Alle aktuell gewählten Kurse werden abgewählt. Wollen Sie fortfahren?"))return!1;this.coursesList=[],this.#n()}return!0}#n(){this.elements.selectedCoursesCount&&(this.elements.selectedCoursesCount.innerHTML=this.coursesList.length)}#t(){this.elements.paginationContainer&&this.elements.paginationTarget&&this.elements.paginationTarget.appendChild(this.elements.paginationContainer)}}export default new SelectCoursesModule;